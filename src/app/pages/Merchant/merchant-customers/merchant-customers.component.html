<!-- merchant-customers.component.html -->
<div class="customers-page" dir="rtl">
  <!-- Header -->
  <header class="settings-header">
    <div class="header-content">
      <div class="header-main">
        <div class="logo-section">
          <div class="settings-badge">
            <span class="badge-icon">โ๏ธ</span>
            <span class="badge-text">ุฅุนุฏุงุฏุงุช ุงูุนููุงุก</span>
          </div>
          <div class="header-titles">
            <h1 class="main-title">ุฅุฏุงุฑุฉ ูุฅุนุฏุงุฏุงุช</h1>
          </div>
        </div>
        
        <div class="header-actions">
        <button class="header-btn back-btn" (click)="goBack()">โ ุงูุนูุฏุฉ</button>

          <button class="refresh-btn" (click)="lastUpdated()">
            <span>๐ ุชุญุฏูุซ</span>
          </button>
        </div>
      </div>
    </div>
  </header>
  <!-- Stats Summary -->
  <div class="stats-summary">
    <div class="stat-card">
      <div class="stat-icon">๐ฅ</div>
      <div class="stat-content">
        <span class="stat-value">{{ filteredCustomers().length }}</span>
        <span class="stat-label">ุฅุฌูุงูู ุงูุนููุงุก</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">โ</div>
      <div class="stat-content">
        <span class="stat-value">{{ getActiveCustomersCount() }}</span>
        <span class="stat-label">ูุดุทูู</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">โธ๏ธ</div>
      <div class="stat-content">
        <span class="stat-value">{{ filteredCustomers().length - getActiveCustomersCount() }}</span>
        <span class="stat-label">ููููููู</span>
      </div>
    </div>
  </div>



  <!-- Customers Table -->
  <div class="customers-table">
    <div *ngIf="filteredCustomers().length > 0" class="table-wrapper">
      <table class="customers-list">
        <thead>
          <tr>
            <th>ุงูุงุณู</th>
            <th>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</th>
            <th>ุฑูู ุงููุงุชู</th>
            <th>ุฑูู ุงูููุญุฉ</th>
            <th>ุนุฏุฏ ุงูุบุณูุงุช</th>
            <th>ุงูุญุงูุฉ</th>
            <th>ุงูุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let customer of filteredCustomers()" [class.inactive]="!customer.isActive">
            <td class="name-cell">
              <div class="customer-name">
                <span class="avatar">{{ customer.name.charAt(0).toUpperCase() }}</span>
                {{ customer.name }}
              </div>
            </td>
            <td>{{ customer.email }}</td>
            <td>{{ customer.phone }}</td>
            <td>{{ customer.plateNumber || '-' }}</td>
            <td class="washes-cell">
              <span class="wash-badge">{{ customer.totalWashes || 0 }}</span>
            </td>
            <td>
              <span class="status-badge" [class.active]="customer.isActive" [class.inactive]="!customer.isActive">
                {{ customer.isActive ? 'โ ูุดุท' : 'โธ๏ธ ููููู' }}
              </span>
            </td>
            <td class="actions-cell">
              <button class="action-btn view-btn" (click)="viewCustomer(customer)" title="ุนุฑุถ ุงูุชูุงุตูู">
                ๐๏ธ
              </button>
              <button class="action-btn edit-btn" (click)="openEditCustomerModal(customer)" title="ุชุนุฏูู">
                โ๏ธ
              </button>
              <button *ngIf="customer.isActive" class="action-btn deactivate-btn" (click)="confirmDeactivate(customer)" title="ุฅููุงู ูุคูุช">
                โธ๏ธ
              </button>
              <button *ngIf="!customer.isActive" class="action-btn activate-btn" (click)="confirmActivate(customer)" title="ุชูุนูู">
                โถ๏ธ
              </button>
              <button class="action-btn delete-btn" (click)="confirmDelete(customer)" title="ุญุฐู">
                ๐๏ธ
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredCustomers().length === 0" class="empty-state">
      <div class="empty-icon">๐ค</div>
      <h3>ูุง ููุฌุฏ ุนููุงุก</h3>
      <p *ngIf="searchTerm">ูู ูุชู ุงูุนุซูุฑ ุนูู ุนููุงุก ูุทุงุจููู ููุจุญุซ</p>
      <p *ngIf="!searchTerm">ูุง ููุฌุฏ ุนููุงุก ูุณุฌููู ุจุนุฏ</p>
    </div>
  </div>

  <!-- EDIT CUSTOMER MODAL -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ุชุนุฏูู ุจูุงูุงุช ุงูุนููู</h2>
        <button class="close-btn" (click)="closeEditModal()">โ</button>
      </div>
      
      <form [formGroup]="editForm" class="modal-form">
        <div class="form-group">
          <label>ุงูุงุณู ุงููุงูู *</label>
          <input type="text" formControlName="name" placeholder="ุฃุฏุฎู ุงุณู ุงูุนููู">
          <span *ngIf="editForm.get('name')?.invalid && editForm.get('name')?.touched" class="error-text">
            ุงูุงุณู ูุทููุจ
          </span>
        </div>

        <div class="form-group">
          <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *</label>
          <input type="email" formControlName="email" placeholder="example@domain.com">
          <span *ngIf="editForm.get('email')?.invalid && editForm.get('email')?.touched" class="error-text">
            ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุบูุฑ ุตุญูุญ
          </span>
        </div>

        <div class="form-group">
          <label>ุฑูู ุงููุงุชู *</label>
          <input type="tel" formControlName="phone" placeholder="+966 50 000 0000">
          <span *ngIf="editForm.get('phone')?.invalid && editForm.get('phone')?.touched" class="error-text">
            ุฑูู ุงููุงุชู ูุทููุจ
          </span>
        </div>

        <div class="form-group">
          <label>ุฑูู ุงูููุญุฉ</label>
          <input type="text" formControlName="plateNumber" placeholder="ุฑูู ููุญุฉ ุงูุณูุงุฑุฉ">
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-cancel" (click)="closeEditModal()">ุฅูุบุงุก</button>
          <button type="button" class="btn btn-primary" (click)="saveEdit()" [disabled]="editForm.invalid || isLoading()">
            <span *ngIf="!isLoading()">ุญูุธ ุงูุชุบููุฑุงุช</span>
            <span *ngIf="isLoading()">ุฌุงุฑู ุงูุญูุธ...</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- VIEW CUSTOMER DETAILS MODAL -->
  <div *ngIf="showDetailsModal && selectedCustomer()" class="modal-overlay" (click)="closeDetailsModal()">
    <div class="modal-content details-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ุชูุงุตูู ุงูุนููู</h2>
        <button class="close-btn" (click)="closeDetailsModal()">โ</button>
      </div>
      
      <div class="customer-details">
        <div class="customer-avatar">
          <div class="avatar-large">{{ selectedCustomer()!.name.charAt(0).toUpperCase() }}</div>
          <h3>{{ selectedCustomer()!.name }}</h3>
          <span class="status-badge-large" [class.active]="selectedCustomer()!.isActive">
            {{ selectedCustomer()!.isActive ? 'โ ูุดุท' : 'โธ๏ธ ููููู' }}
          </span>
        </div>

        <div class="detail-grid">
          <div class="detail-section">
            <h4>ูุนูููุงุช ุงูุนููู</h4>
            <div class="detail-item">
              <span class="label">๐ง ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</span>
              <span class="value">{{ selectedCustomer()!.email }}</span>
            </div>
            <div class="detail-item">
              <span class="label">๐ ุฑูู ุงููุงุชู:</span>
              <span class="value">{{ selectedCustomer()!.phone }}</span>
            </div>
            <div class="detail-item">
              <span class="label">๐ ุฑูู ุงูููุญุฉ:</span>
              <span class="value">{{ selectedCustomer()!.plateNumber || '-' }}</span>
            </div>
            <div class="detail-item">
              <span class="label">๐ ุชุงุฑูุฎ ุงูุงูุถูุงู:</span>
              <span class="value">{{ selectedCustomer()!.createdAt | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>

          <div class="detail-section">
            <h4>ุงูุฅุญุตุงุฆูุงุช</h4>
            <div class="detail-item">
              <span class="label">๐ซง ุนุฏุฏ ุงูุบุณูุงุช:</span>
              <span class="value">{{ selectedCustomer()!.totalWashes || 0 }}</span>
            </div>
            <div class="detail-item">
              <span class="label">๐ ุนุฏุฏ ุงูููุงูุขุช:</span>
              <span class="value">{{ selectedCustomer()!.loyaltyPoints || 0 }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-cancel" (click)="closeDetailsModal()">ุฅุบูุงู</button>
      </div>
    </div>
  </div>

  <!-- CONFIRMATION MODAL -->
  <div *ngIf="showConfirmModal" class="modal-overlay" (click)="cancelOperation()">
    <div class="modal-content confirm-modal" (click)="$event.stopPropagation()">
      <div class="confirm-icon">{{ confirmButtonText === 'ุญุฐู' ? '๐๏ธ' : 'โ๏ธ' }}</div>
      <h2>{{ confirmTitle }}</h2>
      <p>{{ confirmMessage }}</p>
      <div class="modal-actions">
        <button class="btn btn-cancel" (click)="cancelOperation()">ุฅูุบุงุก</button>
        <button class="btn btn-danger" (click)="confirmOperation()" [disabled]="isLoading()">
          <span *ngIf="!isLoading()">{{ confirmButtonText }}</span>
          <span *ngIf="isLoading()">ุฌุงุฑู ุงููุนุงูุฌุฉ...</span>
        </button>
      </div>
    </div>
  </div>
</div>